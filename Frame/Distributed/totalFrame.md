# 分布式存储


## 什么是分布式存储？
**分布式存储系统是大量普通PC服务器通过互联网互联，对外作为一个整体提供存储服务**  
  
### 分布式协议
#### 1. CAP 定理
**一个分布式系统不可能同时满足一致性( Consistency )，可用性( Availability )，分区容错性( Partition Tolerance )**  
(1) **一致性**:指的是数据在多个副本中是否能够保持一致的特性    
(2) **可用性**：系统提供的服务必须处于可用的状态，对于用户的每一个请求总要在有限的时间内返回结果    
(3) **分区容错性**：分布式系统在遇到任何网络分区故障的时候，仍然需要能够保证对外提供满足一致性和可用性的服务  
**对于一个分布式系统而言，分区容错性是一个最基本的要求**  
[参考1：CAP 理论 —— 最通俗的解释](https://blog.csdn.net/mengyou0304/article/details/39928451)  
[参考2：CAP理论举例及说明](https://blog.csdn.net/lihao21/article/details/81051631)  

```
CA	放弃分区容错性，加强一致性和可用性，其实就是传统的单机数据库的选择
AP	放弃一致性(这里说的一致性是强一致性)，追求分区容错性和可用性，这是很多分布式系统设计时的选择，例如很多NoSQL系统就是如此
CP	放弃可用性，追求一致性和分区容错性，基本不会选择，网络问题会直接让整个系统不可用
```
  
#### 2. BASE 理论
**核心思想：即使无法做到强一致性，但每个应用都可以根据自身业务特点，采用适当的方式来使系统达到最终一致性**  
**BASE : Basically Available(基本可用)、Soft state(软状态)和Eventually consistent(最终一致性)**  
(1) 基本可用：在分布式系统中出现不可预知故障的时候，允许损失部分可用性
(2) 弱状态：允许系统中的数据存在中间状态，并认为该中间状态不会影响系统的整体可用性
(3) 最终一致性：系统中所有的副本，在经过一段时间的同步后，最终能够达到一个一致的状态。五种变种：因果一致性、读己之所写、会话一致性、单调一致性、单调读一致性

#### 3. 2PC与3PC
(1) 2PC :  
所有参与者执行事务操作(不进行提交或者回滚)-> 协调者 询问所有节点是否可以进行事务提交 
-> 都是，发送事务提交命令(存在否，发送事务回滚命令)->进行事务提交(回滚)  

(2) 3PC :  
协调者 询问 所有参与者 事务是否可以执行，这一步不会锁定资源 -> 参与者 反馈YES -> 协调者 接收到所有YES指令
-> 协调者发送事务执行指令，这一步锁住资源。如果由于网络原因参与者在后面没有收到协调者的命令，他也会执行commit
-> 参与者执行事务操作，反馈状态 -> 协调者收到所有参与者的ACK响应，通知所有参与者执行事务的commit
-> 执行commit操作，反馈状态  



### 一致性协议
#### 1.Raft
**Raft 是一种为了管理复制日志的一致性算法**  
(1) 每个Raft节点都有着以下三种状态：  
跟随者（Follower）：向跟随者发送心跳，接收从客户端发来的请求，并同步到其他节点  
候选者（Candidate）：接收来自候选者的投票请求和接收领导者的心跳，如果在一段时间内没有收到任何请求或心跳那么成为候选者并且发起选举。    
领导者（Leader）：若收到大部分节点的投票则成为领导者，如果在选举过程中发现领导者或者任期比自己高的候选者，则变为跟随者，如果选举超时，则重新发起选举。  



## 分布式存储相关的系统
### 1.分布式文件系统
比如HDFS，Ceph。这些专门存大文件  
### 2.对象存储
基本思路就是将多个小文件合并成大文件存储，经典论文FB的HayStack。
这种系统一般读多写少，不需要修改，很少删除，一致性也没那么强，系统相对好做。
基本上HDFS+HBase就能搞定一个这种系统，HBase存元数据，利用HDFS的Append功能将小文件合并成大文件。  
### 3.分布式数据库


## Hadoop 简介

### Hadoop 项目是一个可靠的、可扩展的、基于分布式计算的开源软件，它包括:  
**Hadoop 内核的两个基本部分是 MapReduce 框架，也就是云计算环境，和 Hadoop 分布式文件系统 (HDFS)**  
1.Hadoop 提供了一个分布式文件系统子项目 (HDFS) 和支持MapReduce 分布式计算的软件架构。   
2.HBase 建立在Hadoop 核心上并提供一个可扩展的分布式数据库。   
3.Pig 是一个高高级数据流语言和实施并行计算的框架。它也是构建在 Hadoop 核心之上的。   
4.ZooKeeper 是一个高效的，可靠的协作支持系统。分布式应用程序使用 ZooKeeper 来存储和传输关键共享状态的更新。   
5.Hive 是构建在Hadoop 上的数据仓库。它提供了数据提取，数据随机查询和分析的功能  
**在 Hadoop 核心框架中，MapReduce 常被称为 mapred，HDFS 经常被称为 dfs**  

### MapReduce


### HDFS


