# 领域驱动设计（Domain Driven Design，DDD）



## 1. base

### 1.1 微服务与 DDD

**软件架构模式演进的三个阶段：**

- **第一阶段是单机架构**
  - 面向过程设计
  - 客户端UI + 数据库
  - C/S架构
  - 数据库驱动设计和开发：从设计数据库和字段开始
- **第二阶段是集中式架构**
  - 面试对象设计
  - 业务接入层，业务逻辑层，数据库层
  - 经典三层架构或 SOA 架构
- **第三阶段是分布式微服务架构**
  - ？



**微服务设计和拆分的困境**

- 粒度应该多大?
- 如何拆分和设计?
- 边界在哪里？



> DDD 核心思想是通过领域驱动设计方法定义领域模型，从而确定业务和应用边界，保证业务模型与代码模型的一致性
>
> DDD 是一种处理高度复杂领域的设计思想，它试图分离技术实现的复杂性，并围绕业务概念构建领域模型来控制业务的复杂性，以解决软件难以理解，难以演进的问题。DDD 不是架构，而是一种架构设计方法论，它通过边界划分将复杂业务领域简单化，帮我们设计出清晰的领域和应用边界，可以很容易地实现架构演进



**DDD 包括战略设计和战术设计两部分**

- 战略设计：
  - 业务视角
  - 建立业务领域模型
  - 划分领域边界
  - 建立通用语言的限界上下文，限界上下文
- 战术设计：
  - 技术视角
  - 侧重于领域模型的技术实现
  - 完成软件开发和落地：
    - 聚合根
    - 实体
    - 值对象
    - 领域服务
    - 应用服务
    - 资源库
    - 等代码逻辑的设计和实现



> 事件风暴是建立领域模型的主要方法，它是一个从发散到收敛的过程。
>
> 它通常采用用例分析、场景分析和用户旅程分析，尽可能全面不遗漏地分解业务领域，并梳理领域对象之间的关系，这是一个发散的过程。
>
> 事件风暴过程会产生很多的实体、命令、事件等领域对象，我们将这些领域对象从不同的维度进行聚类，形成如聚合、限界上下文等边界，建立领域模型，这就是一个收敛的过程。

**三步来划定领域模型和微服务的边界：**

- 第一步：在事件风暴中梳理业务过程中的用户操作、事件以及外部依赖关系等，根据这些要素梳理出领域实体等领域对象。
- 第二步：根据领域实体之间的业务关联性，将业务紧密相关的实体进行组合形成聚合，同时确定聚合中的聚合根、值对象和实体。在这个图里，聚合之间的边界是第一层边界，它们在同一个微服务实例中运行，这个边界是逻辑边界，所以用虚线表示。
- 第三步：根据业务及语义边界等因素，将一个或者多个聚合划定在一个限界上下文内，形成领域模型。在这个图里，限界上下文之间的边界是第二层边界，这一层边界可能就是未来微服务的边界，不同限界上下文内的领域逻辑被隔离在不同的微服务实例中运行，物理上相互隔离，所以是物理边界，边界之间用实线来表示。

![base_model](https://raw.githubusercontent.com/XuZhuohao/picture/master/other/DDD/1.base_model.jpg)
