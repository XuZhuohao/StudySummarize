# base elasticsearch

## 1.概述

### 1.1 基本概念

- documents ： 可以建立索引的基本单位

- index：具有相似特征的 documents 集合
- type：**曾经是** index 的逻辑类别或分区，准许在 index 中创建不同类型的 documents, 但是 type在6.0以后被弃用了
- mapping: 处理数据的方式和规则
- Near Realtime (NRT)：轻微的延迟(通常是 1 秒以内)



### 1.2 安装

#### 1.2.1 准备

- 下载：[官方下载页面](https://www.elastic.co/cn/downloads/past-releases#elasticsearch)
  - elasticsearch : [elasticsearch-6.8.15](https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.8.15.tar.gz)
  - kibana: [kibana-6.8.15-linux-x86_64](https://artifacts.elastic.co/downloads/kibana/kibana-6.8.15-linux-x86_64.tar.gz)

- 服务器准备：
  - 虚拟机（服务器）*3

- 环境准备：
  - jdk 1.8+



#### 1.2.2 单节点部署

##### 1.2.2.1  elasticsearch

- 解压：

  > $ tar -zxf elasticsearch-6.8.15.tar.gz

- 直接启动：

  > $ cd elasticsearch-6.8.15
  >
  > $ ./bin/elasticsearch

  - 直接启动异常：

  ```txt
  [2021-03-26T16:32:58,140][WARN ][o.e.b.ElasticsearchUncaughtExceptionHandler] [unknown] uncaught exception in thread [main]
  org.elasticsearch.bootstrap.StartupException: java.lang.RuntimeException: can not run elasticsearch as root
  	at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:163) ~[elasticsearch-6.8.15.jar:6.8.15]
  	at org.elasticsearch.bootstrap.Elasticsearch.execute(Elasticsearch.java:150) ~[elasticsearch-6.8.15.jar:6.8.15]
  	at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:86) ~[elasticsearch-6.8.15.jar:6.8.15]
  	at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:124) ~[elasticsearch-cli-6.8.15.jar:6.8.15]
  	at org.elasticsearch.cli.Command.main(Command.java:90) ~[elasticsearch-cli-6.8.15.jar:6.8.15]
  	at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:116) ~[elasticsearch-6.8.15.jar:6.8.15]
  	at org.elasticsearch.bootstrap.Elasticsearch.main(Elasticsearch.java:93) ~[elasticsearch-6.8.15.jar:6.8.15]
  Caused by: java.lang.RuntimeException: can not run elasticsearch as root
  	at org.elasticsearch.bootstrap.Bootstrap.initializeNatives(Bootstrap.java:103) ~[elasticsearch-6.8.15.jar:6.8.15]
  	at org.elasticsearch.bootstrap.Bootstrap.setup(Bootstrap.java:170) ~[elasticsearch-6.8.15.jar:6.8.15]
  	at org.elasticsearch.bootstrap.Bootstrap.init(Bootstrap.java:333) ~[elasticsearch-6.8.15.jar:6.8.15]
  	at org.elasticsearch.bootstrap.Elasticsearch.init(Elasticsearch.java:159) ~[elasticsearch-6.8.15.jar:6.8.15]
  	... 6 more
  
  ```

  - 根据日志提示，添加用户

  > `// 添加用户elasticseach-user`
  >
  > **$ adduser elasticseach-user**
  >
  > `// 修改用户 elasticseach-user 的密码`
  >
  > **$ passwd elasticseach-user**
  > Changing password for user elasticseach-user.
  > New password: 
  > Retype new password: 
  > passwd: all authentication tokens updated successfully.
  >
  > `// 修改目录权限`
  >
  > **$ chown -R elasticseach-user /data/elasticsearch**
  >
  > `// 切换用户`
  >
  > **$ su elasticseach-user**
  - 再次尝试启动

  > $ ./bin/elasticsearch

##### 1.2.2.2 kibana

- 解压：

  > $ tar -zxf kibana-6.8.15-linux-x86_64.tar.gz
  >
  > $  mv kibana-6.8.15-linux-x86_64 kibana-6.8.15







## 2. 探索你的集群



### 2.1 集群健康